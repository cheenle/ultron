# ULTRON微信通知功能配置说明

## 功能概述
ULTRON现在支持通过微信企业微信API发送新DXCC实体**实时活动通知**，当您**发现未通联过的DXCC实体正在频率上活动**时，会**立即**发送微信消息通知，让您第一时间知道有稀有DXCC出现！

### 🚀 重要升级：实时活动检测
- **不再是**通联成功后通知
- **而是**在解码时发现未通联DXCC**立即**通知
- **让您第一时间**知道稀有DXCC正在频率上活动
- **30分钟防重复机制**，避免频繁通知同一DXCC

## 配置步骤

### 1. 注册企业微信
1. 访问 https://work.weixin.qq.com/ 注册企业微信
2. 创建企业（可以使用个人名义）
3. 进入管理后台

### 2. 创建应用
1. 在管理后台点击"应用管理"
2. 点击"创建应用"
3. 填写应用信息：
   - 应用名称：ULTRON通知
   - 应用介绍：DXCC通联通知
   - 上传应用logo（可选）
4. 创建完成后，记录以下信息：
   - AgentId（应用ID）
   - Secret（应用密钥）

### 3. 获取企业ID
1. 在管理后台点击"我的企业"
2. 找到"企业ID"并记录

### 4. 配置wechat_config.php
编辑 `wechat_config.php` 文件，填入获取的信息：

```php
$wechat_config = array(
    'corp_id' => '你的企业ID',
    'corp_secret' => '你的应用Secret', 
    'agent_id' => '你的应用ID',
    'to_user' => '@all',  // 发送给所有人
    'enabled' => true     // 启用通知
);
```

### 5. 测试通知功能
运行测试命令：
```bash
php -c extra/php-lnx.ini wechat_config.php
```

## 通知内容格式
### 实时活动通知（新功能）
当发现未通联过的DXCC实体正在频率上活动时，会**立即**收到如下格式的微信消息：

```
🔍 发现未通联DXCC实体活动！

⚠️ 重要提醒：这是一个您还未通联的DXCC实体！

呼号: XX9XX
DXCC: CHINA (318)
波段: 20m
模式: FT8
信号: -15 dB
时间: 2024-01-15 12:30:45

📊 当前统计:
已通联DXCC: 183 个
剩余目标: 154 个
完成度: 54.3%

💡 建议：立即尝试呼叫这个稀有DXCC！
🎯 策略：可以适当提高发射功率，多次尝试呼叫
```

### 通联成功通知（原有功能）
当成功通联到新的DXCC实体时，会收到：

```
🎉 新的DXCC通联！

呼号: XX9XX
DXCC: CHINA (318)
波段: 20m
模式: FT8
时间: 2024-01-15 12:30:45

📊 统计信息:
累计通联DXCC: 184 个
剩余目标: 153 个
```

## 功能特点

### 🔍 智能检测
- **实时活动检测**：在解码瞬间发现未通联DXCC立即通知
- **30分钟防重复**：同一DXCC在30分钟内只通知一次，避免刷屏
- **信号质量分析**：显示SNR帮助判断通联可能性
- **缓存机制**：重启程序后仍然记住已通联的实体

### 📱 实时通知
- **发现即通知**：一旦检测到未通联DXCC活动，**立即**微信通知
- **双重通知**：活动发现通知 + 通联成功通知
- **详细信息**：包含信号强度、建议策略等实用信息
- **智能提醒**：提供通联建议和策略指导

### ⚙️ 灵活配置
- 可以启用/禁用通知功能
- 支持指定接收用户
- 企业微信API稳定可靠

## 故障排除

### 无法收到通知
1. 检查企业微信配置是否正确
2. 确认网络连接正常
3. 查看程序输出是否有错误信息
4. 检查企业微信应用是否有发送消息权限

### 测试命令失败
```bash
# 测试微信配置
php -c extra/php-lnx.ini wechat_config.php

# 测试DXCC通知系统
php -c extra/php-lnx.ini dxcc_notifier.php
```

### 缓存同步问题
```bash
# 手动同步日志到缓存
php -c extra/php-lnx.ini dxcc_notifier.php
```

## 注意事项

1. **隐私保护**：企业微信配置信息请妥善保管
2. **网络要求**：需要能够访问企业微信API服务器
3. **频率限制**：企业微信API有调用频率限制，请勿频繁测试
4. **缓存文件**：`worked_dxcc_cache.json` 文件包含通联记录，请妥善保存

## 扩展功能

未来可以扩展的功能：
- 支持多个通知渠道（钉钉、飞书等）
- 自定义通知模板
- 通联目标达成提醒
- 月度/年度通联报告
- 稀有DXCC实体特殊提醒

## 技术支持

如有问题，请检查：
1. PHP curl扩展是否已安装
2. 企业微信配置是否正确
3. 网络连接是否正常
4. 查看程序运行日志

享受您的新DXCC通联通知功能！🎯